# 🎯 **供应商对账管理前端开发指南**

## 📋 **目录**
- [1. API接口规范](#1-api接口规范)
- [2. 前端文件组织结构](#2-前端文件组织结构)  
- [3. 命名规范](#3-命名规范)
- [4. 路由配置](#4-路由配置)
- [5. 组件开发规范](#5-组件开发规范)
- [6. 数据处理规范](#6-数据处理规范)
- [7. 权限控制](#7-权限控制)
- [8. 开发清单](#8-开发清单)

---

## 🔌 **1. API接口规范**

### **后端接口基础信息**
- **基础路径**: `/api/pur-reconciliation`
- **响应格式**: 统一JSON格式
- **状态码**: 200(成功)、404(未找到)、500(服务器错误)

### **核心接口列表**

#### **1.1 分页查询对账单列表**
```javascript
// GET /api/pur-reconciliation/page
{
  method: 'GET',
  params: {
    supplierId?: Long,         // 供应商ID
    status?: Integer,          // 状态(1-草稿 2-待确认 3-已确认 4-已结算)
    reconciliationNo?: String, // 对账单号
    startDate?: String,        // 开始日期(yyyy-MM-dd)
    endDate?: String,          // 结束日期(yyyy-MM-dd)
    page: Number,              // 页码(从0开始)
    size: Number               // 每页数量
  }
}

// 响应格式
{
  code: 200,
  message: "查询成功",
  data: [...],              // 对账单列表
  total: Number,            // 总数量
  page: Number,             // 当前页码
  size: Number,             // 每页数量
  totalPages: Number        // 总页数
}
```

#### **1.2 获取对账单详情**
```javascript
// GET /api/pur-reconciliation/{id}
// GET /api/pur-reconciliation/no/{reconciliationNo}
```

#### **1.3 CRUD操作**
```javascript
// 创建: POST /api/pur-reconciliation
// 更新: PUT /api/pur-reconciliation/{id}
// 删除: DELETE /api/pur-reconciliation/{id}
```

#### **1.4 业务操作**
```javascript
// 确认对账单: PUT /api/pur-reconciliation/{id}/confirm
// 结算对账单: PUT /api/pur-reconciliation/{id}/settle
// 自动生成对账单: POST /api/pur-reconciliation/auto-generate
// 生成对账单号: GET /api/pur-reconciliation/generate-no
```

#### **1.5 批量操作**
```javascript
// 批量删除: DELETE /api/pur-reconciliation/batch
// 批量确认: PUT /api/pur-reconciliation/batch-confirm
```

---

## 📁 **2. 前端文件组织结构**

### **2.1 目录结构**
```
frontend/src/
├── api/
│   └── reconciliation.js              # 对账管理API封装
├── views/
│   └── purchase/
│       └── reconciliation/
│           ├── index.vue              # 对账单列表页面
│           ├── form.vue               # 对账单表单页面(新增/编辑/查看)
│           └── components/
│               ├── ReconciliationForm.vue        # 对账单表单组件
│               ├── ReconciliationItemTable.vue   # 对账明细表格组件
│               ├── SupplierSelector.vue          # 供应商选择器
│               ├── AutoGenerateDialog.vue        # 自动生成对话框
│               └── BatchOperationDialog.vue      # 批量操作对话框
└── utils/
    └── reconciliation.js              # 对账相关工具函数
```

### **2.2 文件命名规范**
- **页面文件**: 小写+连字符 (`reconciliation/index.vue`)
- **组件文件**: PascalCase (`ReconciliationForm.vue`)
- **API文件**: 小写+驼峰 (`reconciliation.js`)

---

## 🏷️ **3. 命名规范**

### **3.1 路由命名**
```javascript
// 路由路径命名: kebab-case
{
  path: 'purchase/reconciliation',           // 对账单列表
  path: 'purchase/reconciliation/create',    // 新增对账单
  path: 'purchase/reconciliation/edit/:id',  // 编辑对账单
  path: 'purchase/reconciliation/view/:id'   // 查看对账单详情
}

// 路由名称命名: kebab-case
{
  name: 'purchase-reconciliation',
  name: 'purchase-reconciliation-create',
  name: 'purchase-reconciliation-edit',
  name: 'purchase-reconciliation-view'
}
```

### **3.2 API函数命名**
```javascript
// API对象: camelCase + Api后缀
export const reconciliationApi = {
  // 方法命名: 动词 + 名词
  getReconciliationPage(params),      // 获取分页列表
  getReconciliationById(id),          // 根据ID获取详情
  createReconciliation(data),         // 创建对账单
  updateReconciliation(id, data),     // 更新对账单
  deleteReconciliation(id),           // 删除对账单
  confirmReconciliation(id),          // 确认对账单
  settleReconciliation(id),           // 结算对账单
  autoGenerateReconciliation(params), // 自动生成对账单
  batchDeleteReconciliations(ids),    // 批量删除
  batchConfirmReconciliations(ids)    // 批量确认
}
```

### **3.3 组件数据命名**
```javascript
// 响应式数据: camelCase
const reconciliationList = ref([])      // 对账单列表
const selectedReconciliation = ref(null) // 选中的对账单
const formData = ref({})                // 表单数据
const loading = ref(false)              // 加载状态
const dialogVisible = ref(false)       // 对话框显示状态

// 状态枚举
const RECONCILIATION_STATUS = {
  DRAFT: 1,        // 草稿
  PENDING: 2,      // 待确认
  CONFIRMED: 3,    // 已确认
  SETTLED: 4       // 已结算
}
```

---

## 🛣️ **4. 路由配置**

### **4.1 添加到路由配置**
```javascript
// frontend/src/router/index.js
{
  path: 'purchase/reconciliation',
  name: 'purchase-reconciliation',
  component: () => import('@/views/purchase/reconciliation/index.vue'),
  meta: { 
    title: '供应商对账管理',
    requiresAuth: true,
    permission: 'reconciliation-management:view'
  }
},
{
  path: 'purchase/reconciliation/create',
  name: 'purchase-reconciliation-create',
  component: () => import('@/views/purchase/reconciliation/form.vue'),
  meta: { 
    title: '新增对账单',
    requiresAuth: true,
    permission: 'reconciliation-management:create'
  }
},
{
  path: 'purchase/reconciliation/edit/:id',
  name: 'purchase-reconciliation-edit',
  component: () => import('@/views/purchase/reconciliation/form.vue'),
  meta: { 
    title: '编辑对账单',
    requiresAuth: true,
    permission: 'reconciliation-management:edit'
  }
},
{
  path: 'purchase/reconciliation/view/:id',
  name: 'purchase-reconciliation-view',
  component: () => import('@/views/purchase/reconciliation/form.vue'),
  meta: { 
    title: '对账单详情',
    requiresAuth: true,
    permission: 'reconciliation-management:view'
  }
}
```

### **4.2 更新显示映射**
```javascript
// frontend/src/utils/displayMapping.js
export const ROUTE_DISPLAY_MAP = {
  // ... 现有映射
  '/purchase/reconciliation': '供应商对账管理'
}

export const PERMISSION_DISPLAY_MAP = {
  // ... 现有映射
  'reconciliation-management:view': '查看对账单',
  'reconciliation-management:create': '新增对账单',
  'reconciliation-management:edit': '编辑对账单',
  'reconciliation-management:delete': '删除对账单',
  'reconciliation-management:confirm': '确认对账单',
  'reconciliation-management:settle': '结算对账单',
  'reconciliation-management:auto-generate': '自动生成对账单'
}
```

---

## 🧩 **5. 组件开发规范**

### **5.1 表格组件规范**
```vue
<!-- 参考: frontend/src/views/purchase/SupplierList.vue -->
<template>
  <div class="reconciliation-list">
    <!-- 搜索区域 -->
    <div class="search-container">
      <el-form :inline="true" :model="searchForm">
        <el-form-item label="供应商">
          <el-select v-model="searchForm.supplierId" placeholder="请选择供应商">
            <!-- 供应商选项 -->
          </el-select>
        </el-form-item>
        <el-form-item label="状态">
          <el-select v-model="searchForm.status" placeholder="请选择状态">
            <el-option label="草稿" :value="1" />
            <el-option label="待确认" :value="2" />
            <el-option label="已确认" :value="3" />
            <el-option label="已结算" :value="4" />
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="handleSearch">搜索</el-button>
          <el-button @click="handleReset">重置</el-button>
        </el-form-item>
      </el-form>
    </div>

    <!-- 操作按钮区域 -->
    <div class="action-container">
      <el-button type="primary" @click="handleCreate">新增对账单</el-button>
      <el-button type="success" @click="handleAutoGenerate">自动生成</el-button>
      <el-button type="warning" :disabled="!hasSelection" @click="handleBatchConfirm">
        批量确认
      </el-button>
      <el-button type="danger" :disabled="!hasSelection" @click="handleBatchDelete">
        批量删除
      </el-button>
    </div>

    <!-- 数据表格 -->
    <el-table
      :data="reconciliationList"
      v-loading="loading"
      @selection-change="handleSelectionChange"
    >
      <el-table-column type="selection" width="50" />
      <el-table-column prop="reconciliationNo" label="对账单号" width="150" />
      <el-table-column prop="supplierName" label="供应商" width="150" />
      <el-table-column prop="totalAmount" label="总金额" width="120" align="right">
        <template #default="{ row }">
          ¥{{ formatAmount(row.totalAmount) }}
        </template>
      </el-table-column>
      <el-table-column prop="status" label="状态" width="100">
        <template #default="{ row }">
          <el-tag :type="getStatusTagType(row.status)">
            {{ getStatusText(row.status) }}
          </el-tag>
        </template>
      </el-table-column>
      <el-table-column label="操作" width="200" align="center">
        <template #default="{ row }">
          <el-button size="small" @click="handleView(row)">查看</el-button>
          <el-button size="small" type="primary" @click="handleEdit(row)">编辑</el-button>
          <el-button size="small" type="danger" @click="handleDelete(row)">删除</el-button>
        </template>
      </el-table-column>
    </el-table>

    <!-- 分页组件 -->
    <div class="pagination-container">
      <el-pagination
        v-model:current-page="pagination.page"
        v-model:page-size="pagination.size"
        :total="pagination.total"
        :page-sizes="[10, 20, 50, 100]"
        layout="total, sizes, prev, pager, next, jumper"
        @size-change="handleSizeChange"
        @current-change="handleCurrentChange"
      />
    </div>
  </div>
</template>
```

### **5.2 表单组件规范**
```vue
<!-- 参考: frontend/src/views/purchase/components/SupplierForm.vue -->
<template>
  <div class="reconciliation-form">
    <el-form
      ref="formRef"
      :model="formData"
      :rules="formRules"
      label-width="120px"
    >
      <el-row :gutter="20">
        <el-col :span="12">
          <el-form-item label="对账单号" prop="reconciliationNo">
            <el-input
              v-model="formData.reconciliationNo"
              placeholder="系统自动生成"
              readonly
            />
          </el-form-item>
        </el-col>
        <el-col :span="12">
          <el-form-item label="供应商" prop="supplierId">
            <el-select
              v-model="formData.supplierId"
              placeholder="请选择供应商"
              filterable
              style="width: 100%"
            >
              <el-option
                v-for="supplier in supplierList"
                :key="supplier.id"
                :label="supplier.supplierName"
                :value="supplier.id"
              />
            </el-select>
          </el-form-item>
        </el-col>
      </el-row>
      
      <!-- 更多表单项... -->
    </el-form>
  </div>
</template>
```

---

## 📊 **6. 数据处理规范**

### **6.1 API调用封装**
```javascript
// frontend/src/api/reconciliation.js
import request from '@/utils/request'

export const reconciliationApi = {
  // 获取分页列表
  getReconciliationPage(params) {
    return request({
      url: '/api/pur-reconciliation/page',
      method: 'get',
      params
    })
  },

  // 根据ID获取详情
  getReconciliationById(id) {
    return request({
      url: `/api/pur-reconciliation/${id}`,
      method: 'get'
    })
  },

  // 创建对账单
  createReconciliation(data) {
    return request({
      url: '/api/pur-reconciliation',
      method: 'post',
      data
    })
  },

  // 更新对账单
  updateReconciliation(id, data) {
    return request({
      url: `/api/pur-reconciliation/${id}`,
      method: 'put',
      data
    })
  },

  // 删除对账单
  deleteReconciliation(id) {
    return request({
      url: `/api/pur-reconciliation/${id}`,
      method: 'delete'
    })
  },

  // 确认对账单
  confirmReconciliation(id) {
    return request({
      url: `/api/pur-reconciliation/${id}/confirm`,
      method: 'put'
    })
  },

  // 结算对账单
  settleReconciliation(id) {
    return request({
      url: `/api/pur-reconciliation/${id}/settle`,
      method: 'put'
    })
  },

  // 自动生成对账单
  autoGenerateReconciliation(params) {
    return request({
      url: '/api/pur-reconciliation/auto-generate',
      method: 'post',
      params
    })
  },

  // 生成对账单号
  generateReconciliationNo() {
    return request({
      url: '/api/pur-reconciliation/generate-no',
      method: 'get'
    })
  },

  // 批量删除
  batchDeleteReconciliations(ids) {
    return request({
      url: '/api/pur-reconciliation/batch',
      method: 'delete',
      data: ids
    })
  },

  // 批量确认
  batchConfirmReconciliations(ids) {
    return request({
      url: '/api/pur-reconciliation/batch-confirm',
      method: 'put',
      data: ids
    })
  }
}

export default reconciliationApi
```

### **6.2 数据格式化工具**
```javascript
// frontend/src/utils/reconciliation.js
// 状态相关
export const RECONCILIATION_STATUS = {
  DRAFT: 1,        // 草稿
  PENDING: 2,      // 待确认  
  CONFIRMED: 3,    // 已确认
  SETTLED: 4       // 已结算
}

export const STATUS_TEXT_MAP = {
  [RECONCILIATION_STATUS.DRAFT]: '草稿',
  [RECONCILIATION_STATUS.PENDING]: '待确认',
  [RECONCILIATION_STATUS.CONFIRMED]: '已确认',
  [RECONCILIATION_STATUS.SETTLED]: '已结算'
}

export const STATUS_TAG_TYPE_MAP = {
  [RECONCILIATION_STATUS.DRAFT]: 'info',
  [RECONCILIATION_STATUS.PENDING]: 'warning',
  [RECONCILIATION_STATUS.CONFIRMED]: 'success',
  [RECONCILIATION_STATUS.SETTLED]: 'primary'
}

// 格式化金额
export function formatAmount(amount) {
  if (amount === null || amount === undefined) return '0.00'
  return Number(amount).toFixed(2)
}

// 获取状态文本
export function getStatusText(status) {
  return STATUS_TEXT_MAP[status] || '未知状态'
}

// 获取状态标签类型
export function getStatusTagType(status) {
  return STATUS_TAG_TYPE_MAP[status] || 'info'
}

// 验证对账单数据
export function validateReconciliationData(data) {
  const errors = []
  
  if (!data.supplierId) {
    errors.push('请选择供应商')
  }
  
  if (!data.startDate) {
    errors.push('请选择开始日期')
  }
  
  if (!data.endDate) {
    errors.push('请选择结束日期')
  }
  
  if (data.startDate && data.endDate && data.startDate > data.endDate) {
    errors.push('开始日期不能大于结束日期')
  }
  
  return errors
}
```

---

## 🔐 **7. 权限控制**

### **7.1 权限编码规范**
```javascript
// 权限编码: reconciliation-management:operation
const PERMISSIONS = {
  VIEW: 'reconciliation-management:view',           // 查看对账单
  CREATE: 'reconciliation-management:create',       // 新增对账单
  EDIT: 'reconciliation-management:edit',           // 编辑对账单
  DELETE: 'reconciliation-management:delete',       // 删除对账单
  CONFIRM: 'reconciliation-management:confirm',     // 确认对账单
  SETTLE: 'reconciliation-management:settle',       // 结算对账单
  AUTO_GENERATE: 'reconciliation-management:auto-generate' // 自动生成
}
```

### **7.2 组件权限控制**
```vue
<template>
  <div class="reconciliation-list">
    <!-- 只有创建权限才显示新增按钮 -->
    <el-button 
      v-if="hasPermission('reconciliation-management:create')"
      type="primary" 
      @click="handleCreate"
    >
      新增对账单
    </el-button>
    
    <!-- 操作按钮权限控制 -->
    <template #default="{ row }">
      <el-button 
        v-if="hasPermission('reconciliation-management:view')"
        size="small" 
        @click="handleView(row)"
      >
        查看
      </el-button>
      <el-button 
        v-if="hasPermission('reconciliation-management:edit')"
        size="small" 
        type="primary" 
        @click="handleEdit(row)"
      >
        编辑
      </el-button>
      <el-button 
        v-if="hasPermission('reconciliation-management:confirm') && row.status === 2"
        size="small" 
        type="success" 
        @click="handleConfirm(row)"
      >
        确认
      </el-button>
    </template>
  </div>
</template>

<script setup>
import { useUserStore } from '@/stores/user'

const userStore = useUserStore()

// 权限检查函数
const hasPermission = (permission) => {
  return userStore.hasPermission(permission)
}
</script>
```

---

## ✅ **8. 开发清单**

### **8.1 必须创建的文件**
- [ ] `frontend/src/api/reconciliation.js` - API接口封装
- [ ] `frontend/src/views/purchase/reconciliation/index.vue` - 列表页面
- [ ] `frontend/src/views/purchase/reconciliation/form.vue` - 表单页面
- [ ] `frontend/src/utils/reconciliation.js` - 工具函数

### **8.2 可选组件文件**
- [ ] `ReconciliationForm.vue` - 对账单表单组件
- [ ] `ReconciliationItemTable.vue` - 对账明细表格
- [ ] `SupplierSelector.vue` - 供应商选择器
- [ ] `AutoGenerateDialog.vue` - 自动生成对话框
- [ ] `BatchOperationDialog.vue` - 批量操作对话框

### **8.3 配置更新**
- [ ] 更新 `frontend/src/router/index.js` - 添加路由配置
- [ ] 更新 `frontend/src/utils/displayMapping.js` - 添加显示映射
- [ ] 更新菜单配置 - 添加对账管理菜单项

### **8.4 功能开发清单**
- [ ] 对账单列表查询(支持多条件筛选)
- [ ] 对账单新增/编辑/查看
- [ ] 对账单删除(单个/批量)
- [ ] 对账单确认功能
- [ ] 对账单结算功能
- [ ] 自动生成对账单功能
- [ ] 对账明细管理
- [ ] 状态流转控制
- [ ] 权限控制

### **8.5 注意事项**
1. **响应式处理**: 确保所有数据都使用 `ref()` 或 `reactive()` 包装
2. **错误处理**: 每个API调用都要有 try-catch 错误处理
3. **加载状态**: 重要操作要显示loading状态
4. **用户反馈**: 操作成功/失败要给用户明确提示
5. **数据验证**: 表单提交前要进行数据验证
6. **权限控制**: 所有操作都要检查用户权限
7. **响应式布局**: 确保在不同屏幕尺寸下正常显示
8. **代码复用**: 相同逻辑要提取为公共函数或组件

---

## 🎉 **总结**

按照这个指南开发，你将得到一个：
- ✅ **结构清晰**的前端代码
- ✅ **命名统一**的文件和函数  
- ✅ **权限完整**的功能模块
- ✅ **用户友好**的交互体验
- ✅ **维护性强**的代码架构

**开始开发前记得**:
1. 先创建API接口文件
2. 再开发列表页面
3. 然后开发表单页面
4. 最后添加路由和菜单配置

祝开发顺利！🚀 